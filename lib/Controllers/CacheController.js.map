{"version":3,"sources":["../../src/Controllers/CacheController.js"],"names":["KEY_SEPARATOR_CHAR","joinKeys","keys","join","SubCache","constructor","prefix","cacheController","ttl","cache","get","key","cacheKey","put","value","del","clear","CacheController","AdaptableController","adapter","appId","options","role","user","graphQL","then","Promise","resolve","expectedAdapterType","CacheAdapter"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,kBAAkB,GAAG,GAA3B;;AAEA,SAASC,QAAT,CAAkB,GAAGC,IAArB,EAA2B;AACzB,SAAOA,IAAI,CAACC,IAAL,CAAUH,kBAAV,CAAP;AACD;AAED;AACA;AACA;AACA;AACA;;;AACO,MAAMI,QAAN,CAAe;AACpBC,EAAAA,WAAW,CAACC,MAAD,EAASC,eAAT,EAA0BC,GAA1B,EAA+B;AACxC,SAAKF,MAAL,GAAcA,MAAd;AACA,SAAKG,KAAL,GAAaF,eAAb;AACA,SAAKC,GAAL,GAAWA,GAAX;AACD;;AAEDE,EAAAA,GAAG,CAACC,GAAD,EAAM;AACP,UAAMC,QAAQ,GAAGX,QAAQ,CAAC,KAAKK,MAAN,EAAcK,GAAd,CAAzB;AACA,WAAO,KAAKF,KAAL,CAAWC,GAAX,CAAeE,QAAf,CAAP;AACD;;AAEDC,EAAAA,GAAG,CAACF,GAAD,EAAMG,KAAN,EAAaN,GAAb,EAAkB;AACnB,UAAMI,QAAQ,GAAGX,QAAQ,CAAC,KAAKK,MAAN,EAAcK,GAAd,CAAzB;AACA,WAAO,KAAKF,KAAL,CAAWI,GAAX,CAAeD,QAAf,EAAyBE,KAAzB,EAAgCN,GAAhC,CAAP;AACD;;AAEDO,EAAAA,GAAG,CAACJ,GAAD,EAAM;AACP,UAAMC,QAAQ,GAAGX,QAAQ,CAAC,KAAKK,MAAN,EAAcK,GAAd,CAAzB;AACA,WAAO,KAAKF,KAAL,CAAWM,GAAX,CAAeH,QAAf,CAAP;AACD;;AAEDI,EAAAA,KAAK,GAAG;AACN,WAAO,KAAKP,KAAL,CAAWO,KAAX,EAAP;AACD;;AAxBmB;;;;AA2Bf,MAAMC,eAAN,SAA8BC,4BAA9B,CAAkD;AACvDb,EAAAA,WAAW,CAACc,OAAD,EAAUC,KAAV,EAAiBC,OAAO,GAAG,EAA3B,EAA+B;AACxC,UAAMF,OAAN,EAAeC,KAAf,EAAsBC,OAAtB;AAEA,SAAKC,IAAL,GAAY,IAAIlB,QAAJ,CAAa,MAAb,EAAqB,IAArB,CAAZ;AACA,SAAKmB,IAAL,GAAY,IAAInB,QAAJ,CAAa,MAAb,EAAqB,IAArB,CAAZ;AACA,SAAKoB,OAAL,GAAe,IAAIpB,QAAJ,CAAa,SAAb,EAAwB,IAAxB,CAAf;AACD;;AAEDM,EAAAA,GAAG,CAACC,GAAD,EAAM;AACP,UAAMC,QAAQ,GAAGX,QAAQ,CAAC,KAAKmB,KAAN,EAAaT,GAAb,CAAzB;AACA,WAAO,KAAKQ,OAAL,CAAaT,GAAb,CAAiBE,QAAjB,EAA2Ba,IAA3B,CAAgC,IAAhC,EAAsC,MAAMC,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAA5C,CAAP;AACD;;AAEDd,EAAAA,GAAG,CAACF,GAAD,EAAMG,KAAN,EAAaN,GAAb,EAAkB;AACnB,UAAMI,QAAQ,GAAGX,QAAQ,CAAC,KAAKmB,KAAN,EAAaT,GAAb,CAAzB;AACA,WAAO,KAAKQ,OAAL,CAAaN,GAAb,CAAiBD,QAAjB,EAA2BE,KAA3B,EAAkCN,GAAlC,CAAP;AACD;;AAEDO,EAAAA,GAAG,CAACJ,GAAD,EAAM;AACP,UAAMC,QAAQ,GAAGX,QAAQ,CAAC,KAAKmB,KAAN,EAAaT,GAAb,CAAzB;AACA,WAAO,KAAKQ,OAAL,CAAaJ,GAAb,CAAiBH,QAAjB,CAAP;AACD;;AAEDI,EAAAA,KAAK,GAAG;AACN,WAAO,KAAKG,OAAL,CAAaH,KAAb,EAAP;AACD;;AAEDY,EAAAA,mBAAmB,GAAG;AACpB,WAAOC,qBAAP;AACD;;AA9BsD;;;eAiC1CZ,e","sourcesContent":["import AdaptableController from './AdaptableController';\nimport CacheAdapter from '../Adapters/Cache/CacheAdapter';\n\nconst KEY_SEPARATOR_CHAR = ':';\n\nfunction joinKeys(...keys) {\n  return keys.join(KEY_SEPARATOR_CHAR);\n}\n\n/**\n * Prefix all calls to the cache via a prefix string, useful when grouping Cache by object type.\n *\n * eg \"Role\" or \"Session\"\n */\nexport class SubCache {\n  constructor(prefix, cacheController, ttl) {\n    this.prefix = prefix;\n    this.cache = cacheController;\n    this.ttl = ttl;\n  }\n\n  get(key) {\n    const cacheKey = joinKeys(this.prefix, key);\n    return this.cache.get(cacheKey);\n  }\n\n  put(key, value, ttl) {\n    const cacheKey = joinKeys(this.prefix, key);\n    return this.cache.put(cacheKey, value, ttl);\n  }\n\n  del(key) {\n    const cacheKey = joinKeys(this.prefix, key);\n    return this.cache.del(cacheKey);\n  }\n\n  clear() {\n    return this.cache.clear();\n  }\n}\n\nexport class CacheController extends AdaptableController {\n  constructor(adapter, appId, options = {}) {\n    super(adapter, appId, options);\n\n    this.role = new SubCache('role', this);\n    this.user = new SubCache('user', this);\n    this.graphQL = new SubCache('graphQL', this);\n  }\n\n  get(key) {\n    const cacheKey = joinKeys(this.appId, key);\n    return this.adapter.get(cacheKey).then(null, () => Promise.resolve(null));\n  }\n\n  put(key, value, ttl) {\n    const cacheKey = joinKeys(this.appId, key);\n    return this.adapter.put(cacheKey, value, ttl);\n  }\n\n  del(key) {\n    const cacheKey = joinKeys(this.appId, key);\n    return this.adapter.del(cacheKey);\n  }\n\n  clear() {\n    return this.adapter.clear();\n  }\n\n  expectedAdapterType() {\n    return CacheAdapter;\n  }\n}\n\nexport default CacheController;\n"],"file":"CacheController.js"}