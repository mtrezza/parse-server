{"version":3,"sources":["../../../src/Adapters/Auth/index.js"],"names":["apple","require","gcenter","gpgames","facebook","instagram","linkedin","meetup","google","github","twitter","spotify","digits","janrainengage","janraincapture","line","vkontakte","qq","wechat","weibo","oauth2","phantauth","microsoft","keycloak","ldap","anonymous","validateAuthData","Promise","resolve","validateAppId","providers","authDataValidator","adapter","appIds","options","authData","then","loadAuthAdapter","provider","authOptions","defaultAdapter","providerOptions","Object","prototype","hasOwnProperty","call","assign","undefined","optionalAdapter","forEach","key","module","exports","enableAnonymousUsers","_enableAnonymousUsers","setEnableAnonymousUsers","enable","getValidatorForProvider","freeze"],"mappings":"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","sourcesContent":["import loadAdapter from '../AdapterLoader';\n\nconst apple = require('./apple');\nconst gcenter = require('./gcenter');\nconst gpgames = require('./gpgames');\nconst facebook = require('./facebook');\nconst instagram = require('./instagram');\nconst linkedin = require('./linkedin');\nconst meetup = require('./meetup');\nconst google = require('./google');\nconst github = require('./github');\nconst twitter = require('./twitter');\nconst spotify = require('./spotify');\nconst digits = require('./twitter'); // digits tokens are validated by twitter\nconst janrainengage = require('./janrainengage');\nconst janraincapture = require('./janraincapture');\nconst line = require('./line');\nconst vkontakte = require('./vkontakte');\nconst qq = require('./qq');\nconst wechat = require('./wechat');\nconst weibo = require('./weibo');\nconst oauth2 = require('./oauth2');\nconst phantauth = require('./phantauth');\nconst microsoft = require('./microsoft');\nconst keycloak = require('./keycloak');\nconst ldap = require('./ldap');\n\nconst anonymous = {\n  validateAuthData: () => {\n    return Promise.resolve();\n  },\n  validateAppId: () => {\n    return Promise.resolve();\n  },\n};\n\nconst providers = {\n  apple,\n  gcenter,\n  gpgames,\n  facebook,\n  instagram,\n  linkedin,\n  meetup,\n  google,\n  github,\n  twitter,\n  spotify,\n  anonymous,\n  digits,\n  janrainengage,\n  janraincapture,\n  line,\n  vkontakte,\n  qq,\n  wechat,\n  weibo,\n  phantauth,\n  microsoft,\n  keycloak,\n  ldap,\n};\n\nfunction authDataValidator(adapter, appIds, options) {\n  return function (authData) {\n    return adapter.validateAuthData(authData, options).then(() => {\n      if (appIds) {\n        return adapter.validateAppId(appIds, authData, options);\n      }\n      return Promise.resolve();\n    });\n  };\n}\n\nfunction loadAuthAdapter(provider, authOptions) {\n  let defaultAdapter = providers[provider];\n  const providerOptions = authOptions[provider];\n  if (\n    providerOptions &&\n    Object.prototype.hasOwnProperty.call(providerOptions, 'oauth2') &&\n    providerOptions['oauth2'] === true\n  ) {\n    defaultAdapter = oauth2;\n  }\n\n  if (!defaultAdapter && !providerOptions) {\n    return;\n  }\n\n  const adapter = Object.assign({}, defaultAdapter);\n  const appIds = providerOptions ? providerOptions.appIds : undefined;\n\n  // Try the configuration methods\n  if (providerOptions) {\n    const optionalAdapter = loadAdapter(providerOptions, undefined, providerOptions);\n    if (optionalAdapter) {\n      ['validateAuthData', 'validateAppId'].forEach(key => {\n        if (optionalAdapter[key]) {\n          adapter[key] = optionalAdapter[key];\n        }\n      });\n    }\n  }\n\n  // TODO: create a new module from validateAdapter() in\n  // src/Controllers/AdaptableController.js so we can use it here for adapter\n  // validation based on the src/Adapters/Auth/AuthAdapter.js expected class\n  // signature.\n  if (!adapter.validateAuthData || !adapter.validateAppId) {\n    return;\n  }\n\n  return { adapter, appIds, providerOptions };\n}\n\nmodule.exports = function (authOptions = {}, enableAnonymousUsers = true) {\n  let _enableAnonymousUsers = enableAnonymousUsers;\n  const setEnableAnonymousUsers = function (enable) {\n    _enableAnonymousUsers = enable;\n  };\n  // To handle the test cases on configuration\n  const getValidatorForProvider = function (provider) {\n    if (provider === 'anonymous' && !_enableAnonymousUsers) {\n      return;\n    }\n\n    const { adapter, appIds, providerOptions } = loadAuthAdapter(provider, authOptions);\n\n    return authDataValidator(adapter, appIds, providerOptions);\n  };\n\n  return Object.freeze({\n    getValidatorForProvider,\n    setEnableAnonymousUsers,\n  });\n};\n\nmodule.exports.loadAuthAdapter = loadAuthAdapter;\n"],"file":"index.js"}