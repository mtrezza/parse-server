{"version":3,"sources":["../../../src/Adapters/Auth/weibo.js"],"names":["httpsRequest","require","Parse","querystring","validateAuthData","authData","graphRequest","access_token","then","data","uid","id","Error","OBJECT_NOT_FOUND","validateAppId","Promise","resolve","postData","stringify","options","hostname","path","method","headers","Buffer","byteLength","request","module","exports"],"mappings":";;AAAA;AACA,IAAIA,YAAY,GAAGC,OAAO,CAAC,gBAAD,CAA1B;;AACA,IAAIC,KAAK,GAAGD,OAAO,CAAC,YAAD,CAAP,CAAsBC,KAAlC;;AACA,IAAIC,WAAW,GAAGF,OAAO,CAAC,aAAD,CAAzB,C,CAEA;;;AACA,SAASG,gBAAT,CAA0BC,QAA1B,EAAoC;AAClC,SAAOC,YAAY,CAACD,QAAQ,CAACE,YAAV,CAAZ,CAAoCC,IAApC,CAAyC,UAAUC,IAAV,EAAgB;AAC9D,QAAIA,IAAI,IAAIA,IAAI,CAACC,GAAL,IAAYL,QAAQ,CAACM,EAAjC,EAAqC;AACnC;AACD;;AACD,UAAM,IAAIT,KAAK,CAACU,KAAV,CAAgBV,KAAK,CAACU,KAAN,CAAYC,gBAA5B,EAA8C,sCAA9C,CAAN;AACD,GALM,CAAP;AAMD,C,CAED;;;AACA,SAASC,aAAT,GAAyB;AACvB,SAAOC,OAAO,CAACC,OAAR,EAAP;AACD,C,CAED;;;AACA,SAASV,YAAT,CAAsBC,YAAtB,EAAoC;AAClC,MAAIU,QAAQ,GAAGd,WAAW,CAACe,SAAZ,CAAsB;AACnCX,IAAAA,YAAY,EAAEA;AADqB,GAAtB,CAAf;AAGA,MAAIY,OAAO,GAAG;AACZC,IAAAA,QAAQ,EAAE,eADE;AAEZC,IAAAA,IAAI,EAAE,wBAFM;AAGZC,IAAAA,MAAM,EAAE,MAHI;AAIZC,IAAAA,OAAO,EAAE;AACP,sBAAgB,mCADT;AAEP,wBAAkBC,MAAM,CAACC,UAAP,CAAkBR,QAAlB;AAFX;AAJG,GAAd;AASA,SAAOjB,YAAY,CAAC0B,OAAb,CAAqBP,OAArB,EAA8BF,QAA9B,CAAP;AACD;;AAEDU,MAAM,CAACC,OAAP,GAAiB;AACfd,EAAAA,aADe;AAEfV,EAAAA;AAFe,CAAjB","sourcesContent":["// Helper functions for accessing the weibo Graph API.\nvar httpsRequest = require('./httpsRequest');\nvar Parse = require('parse/node').Parse;\nvar querystring = require('querystring');\n\n// Returns a promise that fulfills iff this user id is valid.\nfunction validateAuthData(authData) {\n  return graphRequest(authData.access_token).then(function (data) {\n    if (data && data.uid == authData.id) {\n      return;\n    }\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, 'weibo auth is invalid for this user.');\n  });\n}\n\n// Returns a promise that fulfills if this app id is valid.\nfunction validateAppId() {\n  return Promise.resolve();\n}\n\n// A promisey wrapper for weibo graph requests.\nfunction graphRequest(access_token) {\n  var postData = querystring.stringify({\n    access_token: access_token,\n  });\n  var options = {\n    hostname: 'api.weibo.com',\n    path: '/oauth2/get_token_info',\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n      'Content-Length': Buffer.byteLength(postData),\n    },\n  };\n  return httpsRequest.request(options, postData);\n}\n\nmodule.exports = {\n  validateAppId,\n  validateAuthData,\n};\n"],"file":"weibo.js"}