{"version":3,"sources":["../../src/Routers/HooksRouter.js"],"names":["HooksRouter","PromiseRouter","createHook","aHook","config","hooksController","then","hook","response","updateHook","handlePost","req","body","handleGetFunctions","params","functionName","getFunction","foundFunction","Parse","Error","Promise","resolve","getFunctions","functions","err","handleGetTriggers","className","triggerName","getTrigger","foundTrigger","getTriggers","triggers","handleDelete","deleteFunction","deleteTrigger","handleUpdate","url","handlePut","__op","mountRoutes","route","middleware","promiseEnforceMasterKeyAccess","bind"],"mappings":"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","sourcesContent":["import { Parse } from 'parse/node';\nimport PromiseRouter from '../PromiseRouter';\nimport * as middleware from '../middlewares';\n\nexport class HooksRouter extends PromiseRouter {\n  createHook(aHook, config) {\n    return config.hooksController.createHook(aHook).then(hook => ({ response: hook }));\n  }\n\n  updateHook(aHook, config) {\n    return config.hooksController.updateHook(aHook).then(hook => ({ response: hook }));\n  }\n\n  handlePost(req) {\n    return this.createHook(req.body, req.config);\n  }\n\n  handleGetFunctions(req) {\n    var hooksController = req.config.hooksController;\n    if (req.params.functionName) {\n      return hooksController.getFunction(req.params.functionName).then(foundFunction => {\n        if (!foundFunction) {\n          throw new Parse.Error(143, `no function named: ${req.params.functionName} is defined`);\n        }\n        return Promise.resolve({ response: foundFunction });\n      });\n    }\n\n    return hooksController.getFunctions().then(\n      functions => {\n        return { response: functions || [] };\n      },\n      err => {\n        throw err;\n      }\n    );\n  }\n\n  handleGetTriggers(req) {\n    var hooksController = req.config.hooksController;\n    if (req.params.className && req.params.triggerName) {\n      return hooksController\n        .getTrigger(req.params.className, req.params.triggerName)\n        .then(foundTrigger => {\n          if (!foundTrigger) {\n            throw new Parse.Error(143, `class ${req.params.className} does not exist`);\n          }\n          return Promise.resolve({ response: foundTrigger });\n        });\n    }\n\n    return hooksController.getTriggers().then(triggers => ({ response: triggers || [] }));\n  }\n\n  handleDelete(req) {\n    var hooksController = req.config.hooksController;\n    if (req.params.functionName) {\n      return hooksController.deleteFunction(req.params.functionName).then(() => ({ response: {} }));\n    } else if (req.params.className && req.params.triggerName) {\n      return hooksController\n        .deleteTrigger(req.params.className, req.params.triggerName)\n        .then(() => ({ response: {} }));\n    }\n    return Promise.resolve({ response: {} });\n  }\n\n  handleUpdate(req) {\n    var hook;\n    if (req.params.functionName && req.body.url) {\n      hook = {};\n      hook.functionName = req.params.functionName;\n      hook.url = req.body.url;\n    } else if (req.params.className && req.params.triggerName && req.body.url) {\n      hook = {};\n      hook.className = req.params.className;\n      hook.triggerName = req.params.triggerName;\n      hook.url = req.body.url;\n    } else {\n      throw new Parse.Error(143, 'invalid hook declaration');\n    }\n    return this.updateHook(hook, req.config);\n  }\n\n  handlePut(req) {\n    var body = req.body;\n    if (body.__op == 'Delete') {\n      return this.handleDelete(req);\n    } else {\n      return this.handleUpdate(req);\n    }\n  }\n\n  mountRoutes() {\n    this.route(\n      'GET',\n      '/hooks/functions',\n      middleware.promiseEnforceMasterKeyAccess,\n      this.handleGetFunctions.bind(this)\n    );\n    this.route(\n      'GET',\n      '/hooks/triggers',\n      middleware.promiseEnforceMasterKeyAccess,\n      this.handleGetTriggers.bind(this)\n    );\n    this.route(\n      'GET',\n      '/hooks/functions/:functionName',\n      middleware.promiseEnforceMasterKeyAccess,\n      this.handleGetFunctions.bind(this)\n    );\n    this.route(\n      'GET',\n      '/hooks/triggers/:className/:triggerName',\n      middleware.promiseEnforceMasterKeyAccess,\n      this.handleGetTriggers.bind(this)\n    );\n    this.route(\n      'POST',\n      '/hooks/functions',\n      middleware.promiseEnforceMasterKeyAccess,\n      this.handlePost.bind(this)\n    );\n    this.route(\n      'POST',\n      '/hooks/triggers',\n      middleware.promiseEnforceMasterKeyAccess,\n      this.handlePost.bind(this)\n    );\n    this.route(\n      'PUT',\n      '/hooks/functions/:functionName',\n      middleware.promiseEnforceMasterKeyAccess,\n      this.handlePut.bind(this)\n    );\n    this.route(\n      'PUT',\n      '/hooks/triggers/:className/:triggerName',\n      middleware.promiseEnforceMasterKeyAccess,\n      this.handlePut.bind(this)\n    );\n  }\n}\n\nexport default HooksRouter;\n"],"file":"HooksRouter.js"}